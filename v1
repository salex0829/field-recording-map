<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Field Recording Map</title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
      .info {
        width: 250px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      let map;
      let tempMarker;

      const soundPoints = [
        {
          position: { lat: 33.1591, lng: 129.7225 },
          title: "‰Ωê‰∏ñ‰øù ÊúùÂ∏Ç„ÅÆÈü≥",
          description: "Êúù„ÅÆÊ¥ªÊ∞ó„ÅÇ„Åµ„Çå„Çã‰Ωê‰∏ñ‰øùÊúùÂ∏Ç„ÅÆÁí∞Â¢ÉÈü≥„Åß„Åô„ÄÇ",
          audioUrl: "https://drive.google.com/uc?export=preview&id=YOUR_FILE_ID1"
        },
        {
          position: { lat: 33.2046, lng: 129.7435 },
          title: "ÁôΩÊµúÊµ∑Ê∞¥Êµ¥Â†¥",
          description: "Ê≥¢„ÅÆÈü≥„Å®ÂÆ∂Êóè„ÅÆÁ¨ë„ÅÑÂ£∞„ÅåÈüø„Åè„ÄÅÂ§è„ÅÆÊµ∑Ëæ∫„ÅÆÈü≥„ÄÇ",
          audioUrl: "https://drive.google.com/uc?export=preview&id=YOUR_FILE_ID2"
        }
      ];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: soundPoints[0].position,
        });

        soundPoints.forEach(addMarkerWithInfo);

        map.addListener("click", (e) => {
          if (tempMarker) tempMarker.setMap(null);
          tempMarker = new google.maps.Marker({
            position: e.latLng,
            map,
          });

          const formHtml = `
            <div class="info">
              <h3>Êñ∞„Åó„ÅÑÈü≥Ê∫ê„ÇíËøΩÂä†</h3>
              <label>„Çø„Ç§„Éà„É´: <input id="title" type="text"></label><br/>
              <label>Ë™¨Êòé: <input id="desc" type="text"></label><br/>
              <label>Google Drive ID: <input id="audioId" type="text"></label><br/>
              <button onclick="submitForm()">ËøΩÂä†</button>
            </div>
          `;

          const infoWindow = new google.maps.InfoWindow({
            content: formHtml,
            position: e.latLng,
          });

          infoWindow.open(map, tempMarker);
        });
      }

      function addMarkerWithInfo(point) {
        const marker = new google.maps.Marker({
          position: point.position,
          map,
          title: point.title
        });

        const infoDiv = document.createElement('div');
        infoDiv.className = 'info';
        infoDiv.innerHTML = `
          <h3>${point.title}</h3>
          <p>${point.description}</p>
          <audio controls>
            <source src="${point.audioUrl}" type="audio/mp3">
            Your browser does not support the audio element.
          </audio><br/>
        `;

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'üóëÔ∏è ÂâäÈô§';
        deleteBtn.onclick = () => {
          marker.setMap(null);
        };

        infoDiv.appendChild(deleteBtn);

        const infoWindow = new google.maps.InfoWindow({
          content: infoDiv,
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });
      }

      function submitForm() {
        const title = document.getElementById("title").value;
        const desc = document.getElementById("desc").value;
        const audioId = document.getElementById("audioId").value;
        const audioUrl = `https://drive.google.com/uc?export=preview&id=${audioId}`;

        const newPoint = {
          position: tempMarker.getPosition().toJSON(),
          title: title,
          description: desc,
          audioUrl: audioUrl
        };

        addMarkerWithInfo(newPoint);
        tempMarker.setMap(null);
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-sOvPhVoIyjU4C34gFbFmBOriWYOJgW0&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
